<div class="admin-container">
  <!-- Left Sidebar Navigation -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <div class="logo">
        <i class="fas fa-book"></i>
        <span *ngIf="!sidebarCollapsed">Mission Manager</span>
      </div>
      <button class="toggle-btn" (click)="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
    </div>

    <nav class="sidebar-nav">
      <ul class="nav-menu">
        <li class="nav-item" [class.active]="activeMenuItem === 'users'">
          <a (click)="navigateToUsers(); $event.preventDefault()" class="nav-link" style="cursor: pointer;">
            <i class="fas fa-users"></i>
            <span *ngIf="!sidebarCollapsed">Users</span>
          </a>
        </li>

        <li class="nav-item" [class.active]="activeMenuItem === 'missions'">
          <a (click)="navigateToMissions(); $event.preventDefault()" class="nav-link" style="cursor: pointer;">
            <i class="fas fa-rocket"></i>
            <span *ngIf="!sidebarCollapsed">Missions</span>
          </a>
        </li>

        <li class="nav-item" [class.active]="activeMenuItem === 'mission-themes'">
          <a (click)="navigateToMissionThemes(); $event.preventDefault()" class="nav-link" style="cursor: pointer;">
            <i class="fas fa-palette"></i>
            <span *ngIf="!sidebarCollapsed">Mission Themes</span>
          </a>
        </li>

        <li class="nav-item" [class.active]="activeMenuItem === 'mission-skills'">
          <a (click)="navigateToMissionSkills(); $event.preventDefault()" class="nav-link" style="cursor: pointer;">
            <i class="fas fa-cogs"></i>
            <span *ngIf="!sidebarCollapsed">Mission Skills</span>
          </a>
        </li>

        <li class="nav-item" [class.active]="activeMenuItem === 'mission-applications'">
          <a (click)="navigateToMissionApplications(); $event.preventDefault()" class="nav-link" style="cursor: pointer;">
            <i class="fas fa-clipboard-list"></i>
            <span *ngIf="!sidebarCollapsed">Applications</span>
          </a>
        </li>
      </ul>
    </nav>

    <div class="sidebar-footer">
      <div class="user-info" *ngIf="!sidebarCollapsed">
        <div class="user-avatar">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="user-details">
          <span class="username">{{ currentUser?.username }}</span>
          <span class="user-role">{{ currentUser?.role }}</span>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()" [title]="sidebarCollapsed ? 'Logout' : ''">
        <i class="fas fa-sign-out-alt"></i>
        <span *ngIf="!sidebarCollapsed">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content" [class.expanded]="sidebarCollapsed">
    <header class="content-header">
      <h1 class="page-title">
        <span *ngIf="activeMenuItem === 'users'">User Management</span>
        <span *ngIf="activeMenuItem === 'missions'">Mission Management</span>
        <span *ngIf="activeMenuItem === 'mission-themes'">Mission Theme Management</span>
        <span *ngIf="activeMenuItem === 'mission-skills'">Mission Skills Management</span>
        <span *ngIf="activeMenuItem === 'mission-applications'">Mission Applications</span>
      </h1>
      <div class="header-actions">
        <span class="welcome-text">Welcome, {{ currentUser?.username }}!</span>
      </div>
    </header>

    <!-- Dashboard Overview Cards -->
    <div class="dashboard-cards" *ngIf="activeMenuItem === 'users'">
      <div class="dashboard-card">
        <div class="card-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="card-content">
          <h3>Total Users</h3>
          <p class="card-number">{{ getUserCount() }}</p>
        </div>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">
          <i class="fas fa-rocket"></i>
        </div>
        <div class="card-content">
          <h3>Active Missions</h3>
          <p class="card-number">{{ getMissionCount() }}</p>
        </div>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">
          <i class="fas fa-clipboard-list"></i>
        </div>
        <div class="card-content">
          <h3>Total Applications</h3>
          <p class="card-number">{{ getApplicationCount() }}</p>
        </div>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="card-content">
          <h3>Pending Applications</h3>
          <p class="card-number">{{ getPendingApplications() }}</p>
        </div>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area">
      <div class="content-card">
        <!-- Users Management -->
        <div *ngIf="activeMenuItem === 'users'" class="content-section">
          <div class="section-header">
            <h2>User Management</h2>
            <button class="btn btn-primary" (click)="showAddUserForm()">
              <i class="fas fa-plus"></i>
              Add New User
            </button>
          </div>

          <!-- User Form Modal -->
          <div *ngIf="showUserForm" class="modal-overlay">
            <div class="modal-content large-modal">
              <div class="modal-header">
                <h3>{{ editingUserId ? 'Edit User' : 'Create New User' }}</h3>
                <button class="close-btn" (click)="cancelUserForm()">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <form (ngSubmit)="saveUser()" class="form">
                <div class="form-group">
                  <label for="firstName">First Name</label>
                  <input type="text" id="firstName" [(ngModel)]="userForm.firstName" name="firstName" required>
                </div>

                <div class="form-group">
                  <label for="lastName">Last Name</label>
                  <input type="text" id="lastName" [(ngModel)]="userForm.lastName" name="lastName" required>
                </div>

                <div class="form-group">
                  <label for="phoneNumber">Phone Number</label>
                  <input type="tel" id="phoneNumber" [(ngModel)]="userForm.phoneNumber" name="phoneNumber" required>
                </div>

                <div class="form-group">
                  <label for="emailAddress">Email</label>
                  <input type="email" id="emailAddress" [(ngModel)]="userForm.emailAddress" name="emailAddress" required>
                </div>

                <div class="form-group">
                  <label for="password">Password</label>
                  <input type="password" id="password" [(ngModel)]="userForm.password" name="password" [required]="!editingUserId">
                </div>

                <div class="form-group">
                  <label for="roleId">Role</label>
                  <select id="roleId" [(ngModel)]="userForm.roleId" name="roleId" required>
                    <option value="0">Select Role</option>
                    <option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</option>
                  </select>
                </div>

                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" (click)="cancelUserForm()">Cancel</button>
                  <button type="submit" class="btn btn-primary">{{ editingUserId ? 'Update' : 'Create' }}</button>
                </div>
              </form>
            </div>
          </div>


          <!-- Users Table -->
          <div class="data-table">
            <div *ngIf="usersLoading" class="loading">Loading users...</div>
            <table *ngIf="!usersLoading && users.length > 0">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users">
                  <td>{{ user.id }}</td>
                  <td>{{ user.firstName }} {{ user.lastName }}</td>
                  <td>{{ user.emailAddress }}</td>
                  <td>{{ user.roleName }}</td>
                  <td>
                    <button class="btn btn-sm btn-secondary" (click)="editUser(user)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" (click)="deleteUser(user.id)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="!usersLoading && users.length === 0" class="no-data">
              No users found.
            </div>
          </div>
        </div>

        <!-- Missions Management -->
        <div *ngIf="activeMenuItem === 'missions'" class="content-section">
          <div class="section-header">
            <h2>Mission Management</h2>
            <button class="btn btn-primary" (click)="showAddMissionForm()">
              <i class="fas fa-plus"></i>
              Create New Mission
            </button>
          </div>

          <!-- Mission Form Modal -->
           <div *ngIf="showMissionForm" class="modal-overlay">
              <div class="modal-content large-modal">
                <div class="modal-header">
                  <h3>{{ editingMissionId ? 'Edit Mission' : 'Create New Mission' }}</h3>
                  <button class="close-btn" (click)="cancelMissionForm()">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                  <form (ngSubmit)="saveMission()" class="form">
                    <div class="form-group">
                      <label for="missionTitle">Title</label>
                      <input type="text" id="missionTitle" [(ngModel)]="missionForm.missionTitle" name="missionTitle" required>
                    </div>

                    <div class="form-group">
                      <label for="missionDescription">Description</label>
                      <textarea id="missionDescription" [(ngModel)]="missionForm.missionDescription" name="missionDescription" required></textarea>
                    </div>

                    <div class="form-group">
                      <label for="missionOrganisationName">Organisation Name</label>
                      <input type="text" id="missionOrganisationName" [(ngModel)]="missionForm.missionOrganisationName" name="missionOrganisationName">
                    </div>

                    <div class="form-group">
                      <label for="missionOrganisationDetail">Organisation Detail</label>
                      <textarea id="missionOrganisationDetail" [(ngModel)]="missionForm.missionOrganisationDetail" name="missionOrganisationDetail"></textarea>
                    </div>

                    <div class="form-group">
                      <label for="countryId">Country</label>
                      <select id="countryId" [(ngModel)]="missionForm.countryId" name="countryId" (change)="onCountryChange()">
                        <option value="0">Select Country</option>
                        <option *ngFor="let country of countries" [value]="country.id">{{ country.name }}</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="cityId">City</label>
                      <select id="cityId" [(ngModel)]="missionForm.cityId" name="cityId">
                        <option value="0">Select City</option>
                        <option *ngFor="let city of cities" [value]="city.id">{{ city.name }}</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="missionThemeId">Theme</label>
                      <select id="missionThemeId" [(ngModel)]="missionForm.missionThemeId" name="missionThemeId">
                        <option value="0">Select Theme</option>
                        <option *ngFor="let theme of missionThemes" [value]="theme.id">{{ theme.name }}</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="missionType">Mission Type</label>
                      <input type="text" id="missionType" [(ngModel)]="missionForm.missionType" name="missionType">
                    </div>

                    <div class="form-group">
                      <label for="totalSeats">Total Seats</label>
                      <input type="number" id="totalSeats" [(ngModel)]="missionForm.totalSeats" name="totalSeats">
                    </div>

                    <div class="form-group">
                      <label>Skills</label>
                      <div class="checkbox-group">
                        <div *ngFor="let skill of missionSkills" class="checkbox-item">
                          <input 
                            type="checkbox" 
                            [id]="'skill-' + skill.id" 
                            [checked]="isSkillSelected(skill.id)"
                            (change)="onSkillCheckboxChange($event, skill.id)">
                          <label [for]="'skill-' + skill.id">{{ skill.name }}</label>
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="missionImages">Mission Images</label>
                      <input type="file" id="missionImages" (change)="onImageUpload($event)" multiple>
                    </div>

                    <div class="form-group">
                      <label for="missionDocuments">Mission Documents</label>
                      <input type="file" id="missionDocuments" (change)="onDocumentUpload($event)" multiple>
                    </div>

                    <div class="form-group">
                      <label for="missionAvailability">Availability</label>
                      <select id="missionAvailability" [(ngModel)]="missionForm.missionAvailability" name="missionAvailability">
                        <option value="Daily">Daily</option>
                        <option value="Weekly">Weekly</option>
                        <option value="Monthly">Monthly</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="missionVideoUrl">Video URL</label>
                      <input type="text" id="missionVideoUrl" [(ngModel)]="missionForm.missionVideoUrl" name="missionVideoUrl">
                    </div>

                    <div class="form-group">
                      <label for="isActive">Status</label>
                      <select id="isActive" [(ngModel)]="missionForm.isActive" name="isActive">
                        <option [ngValue]="true">Active</option>
                        <option [ngValue]="false">Inactive</option>
                      </select>
                    </div>

                    <div class="form-actions">
                      <button type="button" class="btn btn-secondary" (click)="cancelMissionForm()">Cancel</button>
                      <button type="submit" class="btn btn-primary">{{ editingMissionId ? 'Update' : 'Create' }}</button>
                    </div>
                  </form>
            </div>
          </div>

          <!-- Missions Table -->
          <div class="mission-table-container">
          <div *ngIf="missionsLoading" class="loading-msg">
            <i class="fas fa-spinner fa-spin"></i> Loading missions...
          </div>
          
          <!-- SCROLLABLE WRAPPER -->
          <div class="table-scroll-container">
            <table class="styled-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Description</th>
                  <th>Organization</th>
                  <th>Location</th>
                  <th>Type</th>
                  <th>Seats</th>
                  <th>Availability</th>
                  <th>Theme</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let mission of missions">
                  <td>{{ mission.id }}</td>
                  <td>{{ mission.missionTitle }}</td>
                  <td>{{ mission.missionDescription | slice: 0:50 }}{{ mission.missionDescription.length > 50 ? '...' : '' }}</td>
                  <td>{{ mission.missionOrganisationName }}</td>
                  <td>{{ mission.cityName }}, {{ mission.countryName }}</td>
                  <td>{{ mission.missionType }}</td>
                  <td>{{ mission.totalSeats }}</td>
                  <td>{{ mission.missionAvailability }}</td>
                  <td>{{ mission.missionThemeTitle }}</td>
                  <td>
                    <button class="btn edit" (click)="editMission(mission)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn delete" (click)="deleteMission(mission.id)">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div *ngIf="!missionsLoading && missions.length === 0" class="empty-msg">
            No missions found.
          </div>
        </div>




        </div>

        <!-- Mission Themes Management -->
        <div *ngIf="activeMenuItem === 'mission-themes'" class="content-section">
          <div class="section-header">
            <h2>Mission Theme Management</h2>
            <button class="btn btn-primary" (click)="showAddThemeForm()">
              <i class="fas fa-plus"></i>
              Add New Theme
            </button>
          </div>

          <!-- Theme Form Modal -->
          <div *ngIf="showThemeForm" class="modal-overlay">
            <div class="modal-content">
              <div class="modal-header">
                <h3>{{ editingThemeId ? 'Edit Theme' : 'Add New Theme' }}</h3>
                <button class="close-btn" (click)="cancelThemeForm()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <form (ngSubmit)="saveTheme()" class="form">
                <div class="form-group">
                  <label for="themeName">Name</label>
                  <input type="text" id="themeName" [(ngModel)]="themeForm.name" name="name" required>
                </div>
                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" (click)="cancelThemeForm()">Cancel</button>
                  <button type="submit" class="btn btn-primary">{{ editingThemeId ? 'Update' : 'Create' }}</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Themes Table -->
          <div class="data-table">
            <div *ngIf="themesLoading" class="loading">Loading themes...</div>
            <table *ngIf="!themesLoading && missionThemes.length > 0">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let theme of missionThemes">
                  <td>{{ theme.id }}</td>
                  <td>{{ theme.name }}</td>
                  <td>
                    <button class="btn btn-sm btn-secondary" (click)="editTheme(theme)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" (click)="deleteTheme(theme.id)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="!themesLoading && missionThemes.length === 0" class="no-data">
              No themes found.
            </div>
          </div>
        </div>

        <!-- Mission Skills Management -->
        <div *ngIf="activeMenuItem === 'mission-skills'" class="content-section">
          <div class="section-header">
            <h2>Mission Skills Management</h2>
            <button class="btn btn-primary" (click)="showAddSkillForm()">
              <i class="fas fa-plus"></i>
              Add New Skill
            </button>
          </div>

          <!-- Skill Form Modal -->
          <div *ngIf="showSkillForm" class="modal-overlay">
            <div class="modal-content">
              <div class="modal-header">
                <h3>{{ editingSkillId ? 'Edit Skill' : 'Add New Skill' }}</h3>
                <button class="close-btn" (click)="cancelSkillForm()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <form (ngSubmit)="saveSkill()" class="form">
                <div class="form-group">
                  <label for="skillName">Name</label>
                  <input type="text" id="skillName" [(ngModel)]="skillForm.name" name="name" required>
                </div>
                
                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" (click)="cancelSkillForm()">Cancel</button>
                  <button type="submit" class="btn btn-primary">{{ editingSkillId ? 'Update' : 'Create' }}</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Skills Table -->
          <div class="data-table">
            <div *ngIf="skillsLoading" class="loading">Loading skills...</div>
            <table *ngIf="!skillsLoading && missionSkills.length > 0">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let skill of missionSkills">
                  <td>{{ skill.id }}</td>
                  <td>{{ skill.name }}</td>
                  <td>
                    <button class="btn btn-sm btn-secondary" (click)="editSkill(skill)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" (click)="deleteSkill(skill.id)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="!skillsLoading && missionSkills.length === 0" class="no-data">
              No skills found.
            </div>
          </div>
        </div>

        <!-- Mission Applications Management -->
        <div *ngIf="activeMenuItem === 'mission-applications'" class="content-section">
          <div class="section-header">
            <h2>Mission Applications</h2>
            <div class="header-filters">
              <select class="filter-select">
                <option value="all">All Applications</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
              </select>
            </div>
          </div>
          <div class="placeholder-content">
            <i class="fas fa-clipboard-list placeholder-icon"></i>
            <h3>Mission Applications Management System</h3>
            <p>This section will contain mission application management functionality including:</p>
            <ul>
              <li>View all mission applications</li>
              <li>Review application details</li>
              <li>Approve applications</li>
              <li>Reject applications</li>
              <li>Filter by status</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
