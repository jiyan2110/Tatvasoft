<div class="user-dashboard">
  <!-- Header with Profile -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="dashboard-title">
          <i class="fas fa-rocket"></i>
          Mission Dashboard
        </h1>
        <p class="welcome-message">Welcome back, {{ getUserDisplayName() }}!</p>
      </div>
      
     <div class="header-right">
  <div class="profile-section" (click)="toggleProfileDropdown()">
    <div class="profile-avatar">
      <img [src]="getProfileImageUrl()" [alt]="getUserDisplayName()" class="avatar-image">
    </div>
    <div class="profile-info">
      <span class="profile-name">{{ getUserDisplayName() }}</span>
      <span class="profile-role">{{ currentUser?.role || 'User' }}</span>
    </div>
    <i class="fas fa-chevron-down dropdown-arrow" [class.rotated]="showProfileDropdown"></i>

    <!-- Profile Dropdown -->
    <div class="profile-dropdown" *ngIf="showProfileDropdown">
      <div class="dropdown-item" (click)="navigateToProfile()">
        <i class="fas fa-user"></i>
        <span>My Profile</span>
      </div>
      <div class="dropdown-item" (click)="navigateToMyApplications()">
        <i class="fas fa-clipboard-list"></i>
        <span>My Applications</span>
      </div>
      <div class="dropdown-divider"></div>
      <div class="dropdown-item logout" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </div>
    </div>
  </div>
</div>

    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-content">
    
    <!-- Stats Cards -->
    <div class="stats-section">
      <div class="stats-card">
        <div class="stats-icon">
          <i class="fas fa-rocket"></i>
        </div>
        <div class="stats-content">
          <h3>Available Missions</h3>
          <p class="stats-number">{{ getActiveMissionCount() }}</p>
        </div>
      </div>
    </div>

    <!-- User Profile Summary (Initially hidden) -->
    <div class="profile-summary-card" *ngIf="showUserProfileSummary && userProfile">
      <div class="profile-summary-header">
        <h3>Your Profile</h3>
        <button class="edit-profile-btn" (click)="navigateToProfile()">
          <i class="fas fa-edit"></i>
          Edit Profile
        </button>
      </div>
      <div class="profile-summary-content" *ngIf="!profileLoading">
        <div class="profile-bio">
          <p>{{ userProfile.bio || 'No bio available. Click Edit Profile to add one.' }}</p>
        </div>
      </div>
      <div class="profile-loading" *ngIf="profileLoading">
        <i class="fas fa-spinner fa-spin"></i>
        Loading profile...
      </div>
    </div>

    <!-- Missions Section -->
    <div class="missions-section">

      <!-- Loading State -->
      <div class="loading-container" *ngIf="missionsLoading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading missions...</p>
      </div>

      <!-- Missions Grid -->
      <div class="missions-grid" *ngIf="!missionsLoading && missions.length > 0">
        <div class="mission-card" *ngFor="let mission of missions">
          <div class="mission-image">
            <img [src]="getMissionImageUrl(mission)" [alt]="mission.missionTitle" class="mission-img">
            <div class="mission-overlay">
              <span class="mission-type">{{ mission.missionType }}</span>
            </div>
          </div>
          
          <div class="mission-content">
            <div class="mission-header">
              <h3 class="mission-title">{{ mission.missionTitle }}</h3>
              <span class="mission-theme">{{ mission.missionThemeTitle }}</span>
            </div>
            
            <div class="mission-organization">
              <i class="fas fa-building"></i>
              <span>{{ mission.missionOrganisationName }}</span>
            </div>
            
            <div class="mission-location">
              <i class="fas fa-map-marker-alt"></i>
              <span>{{ mission.cityName }}, {{ mission.countryName }}</span>
            </div>
            
            <p class="mission-description">
              {{ truncateText(mission.missionDescription) }}
            </p>
            
            <div class="mission-meta">
              <div class="mission-availability">
                <i class="fas fa-clock"></i>
                <span>{{ mission.missionAvailability }}</span>
              </div>
              <div class="mission-seats">
                <i class="fas fa-users"></i>
                <span>{{ mission.totalSeats }} seats</span>
              </div>
            </div>
          </div>
          
          <div class="mission-actions">
            <button class="btn btn-outline" (click)="viewMissionDetails(mission.id)">
              <i class="fas fa-eye"></i>
              View Details
            </button>
            <button class="btn btn-primary" (click)="applyToMission(mission.id)">
              <i class="fas fa-paper-plane"></i>
              Apply Now
            </button>
          </div>
        </div>
      </div>

      <!-- No Missions State -->
      <div class="no-missions" *ngIf="!missionsLoading && missions.length === 0">
        <div class="no-missions-icon">
          <i class="fas fa-rocket"></i>
        </div>
        <h3>No Missions Available</h3>
        <p>There are currently no active missions available. Please check back later!</p>
      </div>
    </div>
  </main>
</div>
